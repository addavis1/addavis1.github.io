<!doctype html>
<html>
<head>
<title>Energy</title>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta charset='UTF-8' />
<script src='js/jsvgplot.js'></script>
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css2?family=Chivo:ital,wght@0,400;0,900;1,400;1,900&family=Lato:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">

<script type='text/javascript'>
function energyInit(id) {
	//if ( param == undefined ) { var param = {}; }
	let svg = document.getElementById(id);
	let param = {'coordsRange':[0,0,13,10.5]};	
	coords = new createCoords(id,{'coordsRange':param['coordsRange'],'clip':false,'margin':['3rem','2rem','6rem','2rem']});
	coords.fontSize = 16;	// need to adjust this so that it is dynamic
	let xpts = [1,3,4,6,7,9,10,12];
	coords.plotAxis('x',{'minorNx':0,'grid':false,'xpts':xpts,'xaxisLabelsShow':false,'showX0':true},{},{'stroke':'black','stroke-width':5});
	let textStyle = {'font-size':'4rem','dominant-baseline':'hanging','text-align':'center'};
	
	coords.plotText('KE',{'x':2,'y':-0.25,'append':coords.svg.g2},textStyle);
	coords.plotText('PE',{'x':5,'y':-0.25,'append':coords.svg.g2},textStyle);
	coords.plotText('OE',{'x':8,'y':-0.25,'append':coords.svg.g2},textStyle);
	coords.plotText('E',{'x':11,'y':-0.25,'append':coords.svg.g2},textStyle);
	
	
	plotEnergy(true);
}

function plotEnergy(init) {
	let KE,PE,OE,E,h,KEbar,PEbar,OEbar,Ebar;
	
	KE = document.getElementById('KEinput').value*1;
	PE = document.getElementById('PEinput').value*1;
	OE = document.getElementById('OEinput').value*1;
	E = document.getElementById('Einput').value*1;
	
	if( init != undefined ? init : false ) {
		coords.plotObject('rect',{'x':1,'y':0,'width':2,'height':KE},{'fill':'blue','opacity':0.65,'id':'KEbar'});
		coords.plotObject('rect',{'x':4,'y':0,'width':2,'height':PE},{'fill':'red','opacity':0.65,'id':'PEbar'});
		coords.plotObject('rect',{'x':7,'y':0,'width':2,'height':OE},{'fill':'green','opacity':0.65,'id':'OEbar'});
	}
	else {
		setBar('KE');
		setBar('PE');
		setBar('OE');
	}
	
	// redraw the E bars	
	if( document.getElementById('Eopt2').checked == true ) {
		if( document.getElementById('E0bar') != undefined ) { document.getElementById('E0bar').remove(); }
		if( document.getElementById('E1bar') != undefined ) { 
			document.getElementById('E1bar').remove(); 
			document.getElementById('E2bar').remove(); 
			document.getElementById('E3bar').remove(); 
		} 
		coords.plotObject('rect',{'x':10,'y':0,'width':2,'height':KE},{'fill':'blue','opacity':0.65,'id':'E1bar'});
		coords.plotObject('rect',{'x':10,'y':KE,'width':2,'height':PE},{'fill':'red','opacity':0.65,'id':'E2bar'});
		coords.plotObject('rect',{'x':10,'y':KE+PE,'width':2,'height':OE},{'fill':'green','opacity':0.65,'id':'E3bar'});
		
	} else {
		if( document.getElementById('E1bar') != undefined ) { document.getElementById('E1bar').remove(); }
		if( document.getElementById('E2bar') != undefined ) { document.getElementById('E2bar').remove(); }
		if( document.getElementById('E3bar') != undefined ) { document.getElementById('E3bar').remove(); }
		if( document.getElementById('E0bar') != undefined ) { /* setBar('E0'); */ }
		else { coords.plotObject('rect',{'x':10,'y':0,'width':2,'height':E},{'fill':'black','opacity':0.65,'id':'E0bar'}); }	
	}
	
	if( document.getElementById('KEtext') != undefined ) { document.getElementById('KEtext').remove(); }
	if( document.getElementById('PEtext') != undefined ) { document.getElementById('PEtext').remove(); }
	if( document.getElementById('OEtext') != undefined ) { document.getElementById('OEtext').remove(); }
	if( document.getElementById('Etext') != undefined ) { document.getElementById('Etext').remove(); }
	
	if( document.getElementById('Eopt1').checked == true ) {
		let textStyle,KEtxt,PEtxt,OEtxt,Etxt; 
		textStyle = {'dominant-baseline':'bottom','font-size':'3rem','opacity':0.75};
		KEtxt = (KE/10).toFixed(2)+'E';
		PEtxt = (PE/10).toFixed(2)+'E';
		OEtxt = (OE/10).toFixed(2)+'E';
		Etxt = 'E';
		
		coords.plotText( KEtxt ,{'x':2,'y':KE*1,'dy':0.2},Object.assign({'stroke':'blue','id':'KEtext'},textStyle));
		coords.plotText( PEtxt ,{'x':5,'y':PE*1,'dy':0.2},Object.assign({'stroke':'red','id':'PEtext'},textStyle));
		coords.plotText( OEtxt ,{'x':8,'y':OE*1,'dy':0.2},Object.assign({'stroke':'green','id':'OEtext'},textStyle));
		coords.plotText('E',{'x':11,'y':E*1,'dy':0.2},Object.assign({'stroke':'black','id':'Etext'},textStyle));
	}
	
		
}

function setBar(id,val,y0) {
	if( y0 == undefined ) { var y0 = 0; }
	if( val == undefined ) { val = document.getElementById(id+'input').value*1; }
	let	bar = document.getElementById(id+'bar');
	
	bar.setAttribute('y',coords.v(val));
	bar.setAttribute('height',Math.abs(coords.v(y0)-coords.v(val)));
	
	let txt,x;
	let textStyle = {'dominant-baseline':'bottom','font-size':'3rem','opacity':0.75};
	if( document.getElementById(id+'txt') != undefined ) { document.getElementById(id+'txt').remove(); }
	if( id == 'KE' ) { x = 2; textStyle['stroke'] = 'blue'; }
	else if ( id == 'PE' ) { x = 5; textStyle['stroke'] = 'red'; }
	else if ( id == 'OE' ) { x = 8; textStyle['stroke'] = 'green'; }
	document.getElementById(id+'input').value = val*1;
}

let coords2;
function physicsInit(id) {
	let svg = document.getElementById(id);
	let param = {'coordsRange':[-5,0,5,1010]};	
	coords2 = new createCoords(id,{'coordsRange':param['coordsRange'],'clip':false,'margin':[0,0,0,0]});
	coords2.plotObject('circle',{'cx':0,'cy':0,'r':50},{'fill':'green'});
	coords2.plotObject('circle',{'cx':0,'cy':60,'r':5},{'fill':'red','stroke':'black','id':'projectile'});
}


Math.atanh = function(x) { return(0.5*Math.log((1+x)/(1-x))); }

function animateProjectile() {
	let p,t,t1,t2,n,y,h,i,j,E,PE,KE,OE,v0,param,dt;
	let M,m,R,R0;
	
	
	p = document.getElementById('projectile');
	R = 900; R0 = 50;
	v0 = Math.sqrt(20*(R/R0-1));
	t1 = 0;
	t2 = Math.sqrt(1/20)*R0*Math.sqrt(R/R0-1)+R*Math.atanh(Math.sqrt(R/R0-1));
	t2 = Math.sqrt(1/20)*R0*Math.sqrt(R/R0-1);
	param = {'R':900,'R0':50,'v0':v0};
	n = 1000;
	j = 0;
	E = document.getElementById('Einput').value*1;
	OE = 0;
	y = projectile(t1,param);
	dt = 5;
	for( i = 0; i <= n; i++ ) {
		if( i == 0 ) { impact(); }
	
		window.setTimeout( function (){
			t = t1+j*(t2-t1)/n;
			y = projectile(t,param);
			p.setAttribute('cy',coords2.v(y+10));
			PE = E*y/h; 
			KE = E - PE;
			document.getElementById('KEinput').value = KE.toFixed(2);
			document.getElementById('PEinput').value = PE.toFixed(2);
			document.getElementById('OEinput').value = OE.toFixed(2);
			plotEnergy();
			j++
		},i*dt,y);
		
		
		if( document.getElementById('Eopt3').checked != true ) {
			window.setTimeout( function () {
				document.getElementById('KEinput').value = 0;
				document.getElementById('PEinput').value = 0;
				document.getElementById('OEinput').value = E.toFixed(2);
				plotEnergy();
			},(n+1)*dt);
		}
	}
	if( document.getElementById('Eopt3').checked != true ) { window.setTimeout( function () { impact(); },(n-1)*dt); }
	
}

function projectile(t,param) {
	let y,v0,R,R0;
	if( param == undefined ) { param = {}; }
	//param = Object.assign({'y0':0,'g':9.8,'v0':100},param);
	v0 = param['v0'];
	R0 = param['R0'];
	R = param['R'];
	y = 0.5*(R0+Math.sqrt(R*R+4*20*20*t*t));
	return y;
}

function impact() {
	let d = 'M 0 55 ',r,r1 = .2, r2 = 0.6*r1, x,y, q = 45/4*Math.PI/180, dy,y0=55;
	dy = coords2.height/coords2.width;
	for( let i = -2; i < 19; i++ ) {
		r = (i%2 == 0) ? r1 : r2; 
		x = -r*Math.cos(i*q); y = r*dy/2*Math.sin(i*q)+55;
		d += 'L '+x+' '+y+' ';
	}
	d+='Z';
	coords2.plotObject('path',{'d':d},{'class':'fadeout'});
}


</script>

<style type='text/css'>
body { font-family: Chiva; margin: 0; padding: 0; }
svg { display: block; height: 100vh; width: 100%; }

#container { 
	display: grid;
	grid-template-columns: 1fr auto 1fr auto 1fr;
}
.gridcol { background-color: rgba(0,0,0,0.5); }

#svgcontainer { width: clamp(400px,60vw,1000px); }
#controlscontainer { width: clamp(200px,20vw,400px); }

#physicsscene { width: 100%; height: 80vh; margin-bottom: 2rem; }

#controlscontainer > p { width: clamp(4rem,50%,100%); margin: 0 auto;  }
#controlscontainer > p > button { display: block; margin-top: 1rem; }


.fadeout {
	stroke: red; fill: gold;
	opacity: 0;
  animation-duration: 0.25s;
  animation-name: fadeOut;
}

@keyframes fadeOut {
  from { opacity: 100%; }
  to { opacity: 0%; }
}

</style>   
</head>

<body>
<div id='container'>

<div class='gridcol'></div>

<div id='svgcontainer'>
	<svg id='energysvg' onload='energyInit(this.id);' viewport='0 0 1000 1000'></svg>
</div>

<div class='gridcol' style='min-width: 10px;'></div>

<div id='controlscontainer'>
<svg id='physicsscene' viewport='0 0 10 1000' onload='physicsInit(this.id);'></svg>
<input type='hidden' id='KEinput' value='0'/>
<input type='hidden' id='PEinput' value='0'/>
<input type='hidden' id='OEinput' value='10'/>
<input type='hidden' id='Einput' value='-10'/>
<p><input type='checkbox' id='Eopt1' checked onchange='plotEnergy();'/> Show values</p>
<p><input type='checkbox' id='Eopt2' onchange='plotEnergy();'/> Split E column</p>
<p><input type='checkbox' id='Eopt3' onchange='plotEnergy();'/> Pause before impact</p>
<p><button onclick='animateProjectile();'>launch</button></p>
</div>

<div class='gridcol'></div>

</div>

</body>
</html>