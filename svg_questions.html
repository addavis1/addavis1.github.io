<!DOCTYPE html>
<html lang="en-US"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Centering Test</title>

<style type='text/css'>
/*** CSS FOR SIMULATOR ***/
.bigtext {font:bold 20px serif; fill:white;}
.smalltext {font:bold 16px serif; fill:black;}
.smalltextred {font:normal 14px serif; fill:red;}
.button {background-color: #0000FF; border:2px solid yellow; border-radius: 8px; color:yellow; padding:4px; text-align:center; font-size:20px;}
.fixedWidth {display:inline-block; width:130px;}


/*** CSS FOR RESIZE ENGINE ***/
:root { --bgcolor: black; }
html, body { margin: 0; padding: 0; height: 100%; }
#container {  display: grid;
              grid-template-areas: "a b c";
              grid-template-columns: 1fr auto 1fr;              
              height: 100%;
              background-color: var(--bgcolor);
            }
#container > div:nth-child(1) { grid-area: a; background-color: var(--bgcolor); }
#container > div:nth-child(2) { grid-area: b; align-self: center; var(--bgcolor); }
#container > div:nth-child(3) { grid-area: c; background-color: var(--bgcolor); }
svg { display: block; margin: 0 auto; padding: 0; }

/*** CSS FOR QUESTION ENGINE ***/
#questionBox { display: none; border-radius: 5px 5px 5px 5px; }
#questionBox > div:nth-child(1) { 
	width: 100%; height: 100%;
	color: black;
	background-color: white;
}

#questionBoxTitleBar { display: flex; }
#questionBoxTitleBar > span { border-bottom: 1px solid black; padding: 0.125rem 0.5rem 0.125rem; background-color: #AAAAAA; }
#questionBoxTitleBar > span:nth-child(1) { flex: 1; text-align: left; padding-left: 0.5rem; min-width: 2rem; padding-right: 0; cursor: pointer; }
#questionBoxTitleBar > span:nth-child(2) { flex: 10; text-align: center; min-width: 6rem; cursor: move; }
#questionBoxTitleBar > span:nth-child(3) { flex: 1; text-align: right; padding-right: 0.5rem; min-width: 2rem; padding-left: 0; cursor: pointer; }

#questionBoxContent { padding: 0.5rem; }

#questionBar > div {  background-color: none; opacity: 0.6; display: inline-block; padding: 1px 1px 2px 1px; font-family: sans-serif; }
#questionBar span { display: none; padding: 0 0.4rem; background-color: yellow; height: 100%; border-radius: 0.5rem; cursor: pointer; text-align: center; }
#questionBar span:last-child { display: inline-block; font-weight: bold; }
</style>


<!-- JAVASCRIPT RESIZE ENGINE -->
<script type='text/javascript'>
//window.onresize = location.reload();
function svgResize(svgObj) {
  let w = window.innerWidth;
  let h = window.innerHeight;
  let svgW = svgObj.width.baseVal.valueInSpecifiedUnits;
  let svgH = svgObj.height.baseVal.valueInSpecifiedUnits;
  let svgCon = document.getElementById('svgContainer');  
  let W,H;  
  
  if( svgW/svgH < w/h ) { // svg aspect ratio is more taller than window
    W = h*svgW/svgH;
    H = h;
  } else if ( svgW/svgH >= w/h ) { // svg aspect ratio is shorter than window
    W = w;
    H = w*svgH/svgW;
  }
  svgObj.setAttribute('width',W);  
  svgObj.setAttribute('height',H);
  svgCon.style.width=W+'px';
  svgCon.style.height=H+'px';
}
</script>
<!-- END JAVASCRIPT RESIZE ENGINE -->


<!-- JAVASCRIPT FOR QUESTION ENGINE -->
<script type='text/javascript'>
// each question is a javascript object
function loadQuestion(q) {
	let questionBox = document.getElementById('questionBox');
	let questionBoxContent = document.getElementById('questionBoxContent');
	let questionBoxTitle = document.getElementById('questionBoxTitle');


	if ( typeof(q) == 'object' ) { // load the question popup
		if( (questionBox.style.display == '' || questionBox.style.display == 'none') ||	 q.id != currentQuestionId ) { questionBox.style.display = 'block'; }
		else { questionBox.style.display = 'none'; }
		
		questionBox.width.baseVal.value = q.width ? q.width : 400;
		questionBox.height.baseVal.value = q.height ? q.height : 160;

		questionBoxContent.innerHTML = q.qText;
		if(q.qTitle) { questionBoxTitle.innerHTML = q.qTitle; }
		
		currentQuestionId = q.id; 
	}
	else { questionBox.style.display = 'none'; }
}

function dragElement(id,id2,opt) {
  let svg,obj,obj2, pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0,aspectx,aspecty;
let limitLeft, limitRight, limitTop, limitBottom, pad1 = 50, pad2 = 25;  
  obj = document.getElementById(id);
  obj2 = document.getElementById(id2);
  svg = document.getElementById('svgObject');
  
  aspectx = svg.width.baseVal.value/window.innerWidth;
  aspecty = svg.height.baseVal.value/window.innerHeight;
  
  if( opt == undefined ) {
    obj2.addEventListener("touchstart", touchStart,{capture:true,once:false});
    obj2.addEventListener("mousedown", mouseDown,{capture:true,once:false});
  } else {
    obj2.removeEventListener("touchstart", touchStart,{capture:true,once:false});
    obj2.removeEventListener("mousedown", mouseDown,{capture:true,once:false}); 
  }
  
  ///// START /////
  function touchStart(e) { 
    e = e || window.event;
    e.preventDefault();    
    // get the touch cursor position at startup:
    document.addEventListener('touchend',touchEnd,false);
    document.addEventListener('touchmove',touchMove,false);
  }
  function mouseDown(e) { 
    e = e || window.event;
    e.preventDefault();   

	 // SET UP CONSTRAINTS TO NOT LET THE OBJECT BE DRAGGED OFF SCREEN
	limitLeft = pad1 - obj.width.baseVal.value;
	limitRight = svg.viewBox.baseVal.width - pad1;
	limitTop = 0;
	limitBottom = svg.viewBox.baseVal.height - pad2;
	
    // get the touch cursor position at startup;
	pos1 = e.clientX;
	pos2 = e.clientY;
    
    document.addEventListener('mouseup',mouseEnd,false);
    document.addEventListener('mousemove',mouseMove,false);
  }
  
  ///// MOVIING //////
  function touchMove(e) {
    e.preventDefault();    
    let touches = e.changedTouches;
    //pos1 = pos3 - touches[0].pageX;
  }
  function mouseMove(e) {
    e.preventDefault();
	pos3 = e.clientX;
	pos4 = e.clientY;
	obj.x.baseVal.value += (pos3-pos1)*aspectx;
	obj.y.baseVal.value += (pos4-pos2)*aspecty;
	
	obj.x.baseVal.value = obj.x.baseVal.value < limitLeft ? limitLeft : obj.x.baseVal.value;
	obj.x.baseVal.value = obj.x.baseVal.value > limitRight ? limitRight : obj.x.baseVal.value;
	obj.y.baseVal.value = obj.y.baseVal.value < limitTop ? limitTop : obj.y.baseVal.value;
	obj.y.baseVal.value = obj.y.baseVal.value > limitBottom ? limitBottom : obj.y.baseVal.value;
	
	pos1 = pos3;
	pos2 = pos4;	
  }
  
  ///// ENDING /////
  function touchEnd() {
    document.removeEventListener('touchmove', touchMove, false);
    document.removeEventListener('touchend', touchEnd, false); 
    obj2.addEventListener("touchstart", touchStart,{capture:true,once:false});
  }  
  function mouseEnd() {
    document.removeEventListener('mouseup',mouseEnd,false);
    document.removeEventListener('mousemove',mouseMove,false);
    obj2.addEventListener("mousedown", mouseDown,{capture:true,once:false});
  }
  
}

function toggleQuestionBar() {
	let questionBar = document.getElementById('questionBar');
	let questionNumbers = questionBar.children.item(0).children;
	let n = questionNumbers.length;
	let display = questionNumbers.item(0).style.display=='inline-block' ? 'none' : 'inline-block';
	
	
	for( let i = 0; i < n-1; i++ ) { questionNumbers.item(i).style.display=display;	}
	questionNumbers.item(n-1).innerHTML = questionNumbers.item(0).style.display=='none' ? '&gt;' : '&lt;';

}


</script>
<!-- END JAVASCRIPT FOR QUESTION ENGINE -->


<!-- QUESTIONS for the ENGINE -->
<script type='text/javascript'>
let currentQuestionId = '';

let questionTemplate = {
	id: 'unique' /* required */,
	width: 400 /* default */,
	height: 160 /* default */
}

let question1 = { 
	id:'question1',
	width: 200,	height: 100,
	qTitle:"A Title",
	qText:"This is some question text.",
	qAnswer:"This is the answer."
}

let question2 = {
	id:'question2',
	width: 400,	height: 100,
	qTitle:"Another Title",
	qText:"This is some <b>different</b> question text.",
	qAnswer:"This is the answer to question 2."
}

let question3 = {
	id:'question3',
	width: 400,	height: 200,
	qTitle:"Pfffft",
	qText:"This is some <b>different</b> question text. <br/> It is more involed and has a list. <ol><li>item 1</li><li>item 2</li><li>item 3</li></ol>",
	qAnswer:"This is the answer to question 2."
}
</script>
<!-- END QUESTIONS -->
</head>

<body>
<div id='container'>
<div></div>
<div id='svgContainer'>
<svg id='svgObject' style="position:relative; left:0px; top:0px; background-color:rgb(0,0,0)" onload='svgResize(this,this.width,this.height);' width="800" height="400" viewBox="0 0 800 400">

  <g id="rep1" x="0" y="0" width="400" height="400">
  <svg>
  <line x1="25" y1="25" x2="25" y2="375" stroke="white" stroke-width="2"></line>
  <line x1="25" y1="200" x2="375" y2="200" stroke="white" stroke-width="2"></line>
  <text class="bigtext" x="10" y="250" fill="white" transform="rotate(-90,0,0) translate(-275,-233)">Radial Velocity (m/s)</text>
  <text class="bigtext" x="150" y="385">Time (years)</text>
  <path id="rvcurve" stroke="yellow" opacity=0.75 stroke-width="2" fill="none" d=""></path>
  
  <circle id="point" cx="115.41666666666667" cy="70.05898351064354" r="10" fill="url('#limbDarkening')" stroke="none"></circle>
  <circle id="point2" cx="115.41666666666667" cy="70.05898351064354" r="15" fill="yellow" opacity="0.2" stroke="none"></circle>   
  
  <!-- Draw Arrow  -->
  <path id="arrow" stoke="none" fill="lime" d="M 250,150 l 21 -28 v 14 h 70 v 28 h -70 v 14 l -21 -28 z"></path>
  <text class="smalltext" x="260" y="155">to observer</text>
  </svg>
  </g>

<g id="rep2" transform="translate(400,0)"> 
<svg>
    <!--  Draw Center of Mass Cross  -->
    <g stroke="green" stroke-width="2">
		 <line x1="195" y1="200" x2="205" y2="200"></line>
		 <line x1="200" y1="195" x2="200" y2="205"></line>
	</g>
	<!-- Draw Orbits    -->
	<circle id="StarOrbit" cx="200" cy="200" r="30" fill="none" stroke-width="1" stroke="lightgray"></circle>  
	<circle id="PlanOrbit" cx="200" cy="200" r="180" fill="none" stroke-width="1" stroke="lightgray"></circle> 
    <!-- Draw Star-->
	<g>
	   <svg id="Star" x="1.570078687288319" y="29.958886042637214" onclick='loadQuestion(question2);'>
	        <circle id="StarGlow" cx="200" cy="200" r="15" fill="yellow" opacity="0.3" stroke="none"></circle>   
            <circle id="StarDisc" cx="200" cy="200" r="10" fill="url('#limbDarkening')" stroke="none"></circle>   
          <defs>
              <radialGradient id="limbDarkening">
                  <stop offset="10%" stop-color="yellow"></stop>
                  <stop offset="95%" stop-color="goldenrod"></stop>
              </radialGradient>
          </defs>
	    </svg>
	 </g>
	 <!-- Draw Planet-->
	 <g>
	    <svg id="Planet" x="-9.420472123729851" y="-179.75331625582328" onclick='loadQuestion(question1);'>
	      <circle cx="200" cy="200" r="10" fill="olivedrab" stroke="none"></circle>   
		  <circle cx="200" cy="200" r="8" fill="yellowgreen" stroke="none"></circle>  
		  <circle cx="200" cy="200" r="6" fill="olivedrab" stroke="none"></circle>   
		  <circle cx="200" cy="200" r="2" fill="moccasin" stroke="none"></circle> 
        </svg>		  
	 </g>
	 <!-- Button for Animate/Stop Toggle  -->
	 <g id="button">
	      <rect x="330" y="360" width="60" height="30" rx="10" ry="10" fill="rgb(0,0,255)" stroke="red" stroke-width="2"></rect>
	      <text id="blabel" class="bigprint" x="330" y="380" fill="white" xml:space="preserve">Animate</text>
     </g>
	 
</svg></g>

	<!-- THIS IS THE QUESTION ENGINE SVG MARKUP -->
	<foreignObject x='100' y='50' width='400' height='160' id='questionBox'><div>
    <!-- In the context of SVG embedded in an HTML document, the XHTML namespace could be omitted, but it is mandatory in the context of an SVG document -->
	<div id='questionBoxTitleBar'>
	<span><<</span>
	<span id='questionBoxTitle'>TITLE STUFF</span>
	<span>>></span>
	</div>
    <div id='questionBoxContent'>Question Text</div>	
	</div></foreignObject>
	
	<foreignObject x='0' y='2' width='500' height='30' id='questionBar' fill'none'><div>
	<span onclick='loadQuestion(question1);'>1</span>
	<span onclick='loadQuestion(question2);'>2</span>
	<span onclick='loadQuestion(question3);'>3</span>
	<span onclick='loadQuestion(question2);'>ABC</span>
	<span onclick='toggleQuestionBar();'>&gt;</span>
	</div></foreignObject>


</svg></div>
<div></div>
</div> <!-- end grid container -->



<!-- JAVASCRIPT FOR SIMULATOR -->
<script type="text/javascript">
  var pointx, pointy; 
	var day = 93;
	var RVamp=130;
	var rate = 360/15000;   // a complete cycle in 15 seconds, in a fake year
	var prevTime = null;
  var requestID = null;
	var point = document.getElementById("point");
  var point2 = document.getElementById("point2");
    var button = document.getElementById("button");
	button.addEventListener("mousedown", toggleAnimation);
    drawStuff(day);
    
  addPath();

function animationCallback(time) {

  if (prevTime !== null) {
    var delta = time - prevTime; 
    day=(day+rate*delta)%360;
  }
  drawStuff(day);
  prevTime = time;
  requestID = window.requestAnimationFrame(animationCallback);
}

function drawStuff(day) {
  let pointx,pointy,starx,stary;
	pointx=25+350*(day/365.0);
	pointy=200-RVamp*Math.sin(2*Math.PI*day/365.0);
	point.setAttribute("cx",pointx);
	point.setAttribute("cy",pointy);
  point2.setAttribute("cx",pointx);
	point2.setAttribute("cy",pointy);

	starx=30*Math.cos((-day+180.0)*Math.PI/180.0); // Make planet orbit ccw
  stary=30*Math.sin((-day+180)*Math.PI/180.0);
  planetx=180*Math.cos(-day*Math.PI/180.0);
  planety=180*Math.sin(-day*Math.PI/180.0);
	Star.setAttribute("x",starx);
	Star.setAttribute("y",stary);
	Planet.setAttribute("x",planetx);
	Planet.setAttribute("y",planety);
}

function toggleAnimation() {

  if (requestID !== null) {
    window.cancelAnimationFrame(requestID);
    requestID = null;
    blabel.textContent="Animate";
	} else {
    requestID = window.requestAnimationFrame(animationCallback);
    prevTime = null;
    blabel.textContent = "   Pause";
  }
}

function addPath() {
  let rvcurve = document.getElementById('rvcurve');
  let i,n,A,x0,y0,x,y,x1,path;
  A = RVamp; x0 = 25, y0 = 200; x1 = 375; n = 200;
  path = 'M '+x0+' '+y0;
  
  for( i = 1; i <= n; i++ ) {
    x = x0+i/n*(x1-x0);
    y = y0-A*Math.sin(i/n*2*Math.PI);
    path += ' L '+x+' '+y;  
  }
  rvcurve.setAttribute('d',path);
}


// ADD THE DRAG
dragElement('questionBox','questionBoxTitle');
</script>
<!-- END SIMULATOR JAVASCRIPT -->
	

</body></html>